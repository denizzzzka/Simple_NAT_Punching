# Simple_NAT_Punching
Данный код реализует NAT Punching. Этот алгоритм позволяет общаться клиенту и серверу передавая сообщения напрямую друг другу. Данный пример учебный, и использует некоторые упрощения. Мы будем рассматривать систему, в которой клиент и сервер находятся в разных сетях, отправлять будем единственное сообщение - число от клиента и ответ от сервера.
# Конфигурация Системы и NatPunching.gns3project
Конфигурация и тесты проводились в GNS3. Наша система выглядит так:
![image](https://github.com/denizzzzka/Simple_NAT_Punching/assets/91347518/41fa067b-87c0-4680-a929-fc509444b73f)
Здесь client и server это два взаимодействующих объекта. В данном стенде route-1 и route-2 эмулируют работу роутеров, для этого необходимо прописать для корректной эмуляции:
`iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE`
`iptables -A INPUT -i eth0 -m state --state ESTABLISHED,RELATED -j ACCEPT`
`iptables -A INPUT -i eth0 -j DROP`
helpserver - это вспомогательный сервер, с помощью которого происходит обмен глобальными адресами и портами. NAT в этой системе нужен для подгруке gcc, iptables и т.д.
Для корректной работы стенда, после подгрузке всего необходимого, следует установить маршруты по умолчанию для server и client. Данный проект находится в файле NatPunching.gns3project

# Работа программы
Client/server отгадывает/загадывает число от 1 до 3. У клиента 1 попытка отгадать число сервера. Сначала происходит отправка UDP пакетов для helpserver. После этого клиент и сервер узнают глобальные адреса друг друга и начинают обмен сообщениями. Клиент либо угадал число, либо нет. На этом их взаимодействие заканчивается.
Helpserver принимает два запроса, помещает глобальные адреса и порты в тело сообщения, и отправляет эти сообщения в обратно. Причем куда мы отправляем сообщение и его тело не совпадают. На этом заканчивается работа вспомогательного сервера.
Ниже приведены изображения подобного взаисодействия:
![image](https://github.com/denizzzzka/Simple_NAT_Punching/assets/91347518/f360c39f-63bd-4a7f-b65f-d86abb7abfff)
![image](https://github.com/denizzzzka/Simple_NAT_Punching/assets/91347518/47d869ed-66ee-48b1-9982-4108792c59f6)
![image](https://github.com/denizzzzka/Simple_NAT_Punching/assets/91347518/d399b30f-a5d5-46ea-88d5-0d0c94f8c6bf)


#  Wireshark
Ниже приведена анализ системы с помощью wireshark.
Просмотр канала между helpserver и switch :
![image](https://github.com/denizzzzka/Simple_NAT_Punching/assets/91347518/0aeec921-01af-4c30-829b-e6122f9ec4f6)

Здесь мы видим 4 UDP пакета, 2 - отправленные клиентом и сервером, другие 2 - ответ от helpserver с глобальными данными в теле сообщения.
Этот файл называется Switch-helpServer.pcapng

Просмотр канала между clien и route :
![image](https://github.com/denizzzzka/Simple_NAT_Punching/assets/91347518/f7bad121-95fb-4940-8bb5-23d70c021fb3)

Первые  2 - проброс глобальных данных, следующие - установка соединения, последние 2 - обмен данными.
Этот файл называется Client-route.pcapng
